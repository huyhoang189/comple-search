import { call, put, all, takeEvery, take, select } from "redux-saga/effects";
import malwareSlice from "./slice";
import {
  getMalwares,
  creatMalwares,
  updateMalwares,
  deleteMalwares,
  getMalwareRaw,
} from "../../services/malware.service";
import {
  MESSAGE_DEPARTMENT_DESCRIPTION,
  MESSAGE_DESCRIPTION,
} from "../../commons/constant";
import { notification } from "antd";
function* _getMalwares({ payload }) {
  try {
    const response = yield call(getMalwares, payload);
    // console.log(response);
    if (response.metadata.data.length >= 0) {
      // const list = response.list;
      // console.log(response);
      yield put(
        malwareSlice.actions.getMalwaresSuccess(response.metadata.data)
      );
    }
  } catch (error) {
    notification.error({ message: MESSAGE_DEPARTMENT_DESCRIPTION.GET_ERROR });
    yield put(malwareSlice.actions.getMalwaresError());
  }
}

function* _getRaw({ payload }) {
  try {
    const response = yield call(getMalwareRaw);
    // console.log(response);
    if (response.metadata.data.length >= 0) {
      yield put(malwareSlice.actions.getRawSuccess(response.metadata.data));
    }
  } catch (error) {
    notification.error({ message: MESSAGE_DEPARTMENT_DESCRIPTION.GET_ERROR });
    yield put(malwareSlice.actions.getRawError());
  }
}
function* _processingMalware({ payload }) {
  try {
    let { actionName, item } = payload;
    console.log(actionName, item);
    if (actionName === "ADD_ITEM") {
      const response = yield call(creatMalwares, payload);
      if (response) {
        notification.success({
          message: MESSAGE_DEPARTMENT_DESCRIPTION.ADD_SUCCESS,
        });
      }
    } else if (actionName === "UPDATE_ITEM") {
      const response = yield call(updateMalwares, payload);
      if (response) {
        notification.success({
          message: MESSAGE_DEPARTMENT_DESCRIPTION.UPDATE_SUCCESS,
        });
      }
    } else if (actionName === "DELETE_ITEM") {
      const response = yield call(deleteMalwares, payload);
      if (response) {
        notification.success({
          message: MESSAGE_DEPARTMENT_DESCRIPTION.DELETE_SUCCESS,
        });
      }
    }
    yield put(malwareSlice.actions.getMalwares());
  } catch (error) {
    notification.error({ message: MESSAGE_DESCRIPTION.PROCESSING_ERROR });
    yield put(malwareSlice.actions.processingMalwareError());
  }
}
export default function* saga() {
  yield all([
    yield takeEvery(malwareSlice.actions.getMalwares().type, _getMalwares),
    yield takeEvery(
      malwareSlice.actions.processingMalware().type,
      _processingMalware
    ),

    yield takeEvery(malwareSlice.actions.getRaw().type, _getRaw),
  ]);
}
